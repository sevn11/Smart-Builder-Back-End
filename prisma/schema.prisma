// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["omitApi"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int      @id @default(autoincrement())
  email             String   @unique
  hash              String?
  name              String?
  userType          String   @map("user_type")
  isTosAccepted     Boolean  @default(false) @map("is_tos_accepted")
  tosAcceptanceTime DateTime @default(now()) @map("tos_acceptance_time")
  tosVersion        String?  @default("v1") @map("tos_version")
  companyId         Int?     @map("company_id")
  company           Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  activeAuthToken   String?  @map("active_auth_token")
  isActive      Boolean        @default(true) @map("is_active")
  isDeleted     Boolean?       @default(false) @map("is_deleted")
  PermissionSet PermissionSet?
  stripeCustomerId   String?  @map("stripe_customer_id")
  subscriptionId    String?  @map("subscription_id")
  productId         String?  @map("product_id")
  isDemoUser        Boolean? @default(false) @map("is_demo_user")

  passwordResetCode Int?    @map("password_reset_code")
  invitationToken   String? @map("invitation_token")

  googleAccessToken String? @map("google_access_token")
  googleRefreshToken String? @map("google_refresh_token")
  calendarId        String? @map("calendar_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  PaymentLog      PaymentLog[]
  EmployeeDetails EmployeeDetails?
  GoogleEventId   GoogleEventId[]
  
  @@map("users")
}

model SeoSettings {
  id                    Int             @id @default(autoincrement())
  yearlyPlanAmount      Decimal         @map("yearly_plan_amount") @db.Decimal(10, 2)
  monthlyPlanAmount     Decimal         @map("monthly_plan_amount") @db.Decimal(10, 2)
  additionalEmployeeFee Decimal         @map("additional_employee_fee") @db.Decimal(10, 2) 
  signNowYearlyAmount   Decimal         @map("sign_now_yearly_amount") @db.Decimal(10, 2) @default(0.00)
  signNowMonthlyAmount  Decimal         @map("sign_now_monthly_amount") @db.Decimal(10, 2) @default(0.00)

  @@map("seo_settings")
}

enum ProfitCalculationType {
  MARKUP
  MARGIN
}

model Company {
  id                     Int                     @id @default(autoincrement())
  name                   String?
  address                String?
  contact                String?
  phoneNumber            String?                 @map("phone_number")
  email                  String?
  website                String?
  logo                   String?
  saleTaxRate            Float?                  @map("sale_tax_rate")
  users                  User[]
  customers              Customer[]
  jobs                   Job[]
  projectDescription     ProjectDescription[]
  extraFee               Decimal                 @map("extra_fee") @db.Decimal(10, 2) @default(0.00)
  planType               PlanType?               @map("plan_type")        
  planAmount             Decimal                 @map("plan_amount") @db.Decimal(10, 2) @default(0.00)
  signNowSubscriptionId  String?                 @map("sign_now_subscription_id")
  signNowStripeProductId String?                 @map("sign_now_stripe_product_id")
  categories             Category[]
  contractors            Contractor[]
  JobContractor          JobContractor[]
  JobSchedule            JobSchedule[]
  JobProjectEstimatorHeader    JobProjectEstimatorHeader[]
  ContractorFiles        ContractorFiles[]
  ContractorPhase        ContractorPhase[]
  questionnaireTemplates QuestionnaireTemplate[]
  paymentSchedules       PaymentSchedule[]
  CashFlow               CashFlow[]
  projectEstimatorTemplates     ProjectEstimatorTemplate[]
  projectEstimatorTemplateHeader ProjectEstimatorTemplateHeader[]
  CustomizedContent      CustomizedContent[]
  isActive               Boolean                 @default(true) @map("is_active")
  isDeleted              Boolean?                @default(false) @map("is_deleted")
  profitCalculationType  ProfitCalculationType?  @default(MARGIN) @map("profilt_calculation_type")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  ClientCategory         ClientCategory[]
  ClientTemplate         ClientTemplate[]
  clientQuestionAnswer   ClientQuestionAnswer[]
  JobScheduleLink        JobScheduleLink[]
  GoogleEventId          GoogleEventId[]
  @@map("companies")
}

enum PlanType {
  MONTHLY
  YEARLY
}

model EmployeeDetails {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique @map("user_id")
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  address        String?
  phoneNumber    String?  @map("phone_number")

  @@map("employee_details")
}

model PermissionSet {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique @map("user_id")
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  fullAccess     Boolean  @default(false) @map("full_access")
  accounting     Boolean  @default(false)
  specifications Boolean  @default(false)
  questionnaire  Boolean  @default(false)
  selection      Boolean  @default(false)
  schedule       Boolean  @default(false)
  proposal       Boolean  @default(false)
  contractorAndFiles      Boolean  @default(false) @map("contractor_and_files")
  settings       Boolean  @default(false)
  ytdReport      Boolean  @default(false) @map("ytd_report")
  viewOnly       Boolean  @default(true) @map("view_only")
  isDeleted      Boolean? @default(false) @map("is_deleted")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("permission_sets")
}

model Customer {
  id             Int       @id @default(autoincrement())
  name           String
  address        String?
  state          String?
  city           String?
  zip            String?
  telephone      String?
  mobileNumber1  String?   @map("mobile_number_1")
  mobileNumber2  String?   @map("mobile_number_2")
  emailAddress1  String?   @map("email_address_1")
  emailAddress2  String?   @map("email_address_2")
  employer1      String?   @map("employer_1")
  employer2      String?   @map("employer_2")
  workTelephone1 String?   @map("work_telephone_1")
  workTelephone2 String?   @map("work_telephone_2")
  isDeleted      Boolean?  @default(false) @map("is_deleted")
  meetDate       DateTime? @default(now()) @map("meet_date")
  companyId      Int       @map("company_id")
  company        Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  jobs           Job[]
 
  ContractorFiles        ContractorFiles[]
  ClientCategory         ClientCategory[]
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  ClientTemplate         ClientTemplate[]
  ClientTemplateQuestion ClientTemplateQuestion[]
  clientQuestionAnswer   ClientQuestionAnswer[]
  @@map("customers")
}

model Job {
  id Int @id @default(autoincrement())

  status      String
  descriptionId   Int?                  @map("description_id")
  description     ProjectDescription?   @relation(fields: [descriptionId], references: [id], onDelete: SetNull)
  lotBudget   String? @map("lot_budget")
  totalBudget String? @map("total_budget")
  financing   String?
  timeFrame   String? @map("time_frame")
  aboutUs     String? @map("about_us")

  isClosed           Boolean @default(false) @map("is_closed")
  isDeleted          Boolean @default(false) @map("is_deleted")
  isGasAtLot         Boolean @default(false) @map("is_gas_at_lot")
  isWaterAtLot       Boolean @default(false) @map("is_water_at_lot")
  isElectricityAtLot Boolean @default(false) @map("is_electricity_at_lot")
  isSewerAtLot       Boolean @default(false) @map("is_sewer_at_lot")

  calendarColor      String? @map("calendar_color")
  templateName       String? @map("template_name")
  projectAddress     String? @map("project_address")
  projectState       String? @map("project_state")
  projectCity        String? @map("project_city")
  projectZip         String? @map("project_zip")
  
  houseBudget        String? @map("house_budget")
  sizeOfHouse        String? @map("size_of_house")
  referral           String?
  salesTaxStatus     Boolean? @map("sales_tax_status") @default(false)

  templateId         Int?   @map("template_id")
  template           QuestionnaireTemplate? @relation(fields: [templateId], references: [id])

  JobContractor     JobContractor[]
  JobSchedule       JobSchedule[]
  JobProjectEstimatorHeader JobProjectEstimatorHeader[]
  ContractorFiles        ContractorFiles[]
  paymentSchedules       PaymentSchedule[]

  companyId Int     @map("company_id")
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  customerId Int      @map("customer_id")
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  startDate DateTime? @map("start_date")
  endDate   DateTime? @map("end_date")

  eventId           String?   @map("event_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  ClientTemplate         ClientTemplate[]
  ClientCategory         ClientCategory[]
  ClientTemplateQuestion ClientTemplateQuestion[]
  ClientQuestionAnswer   ClientQuestionAnswer[]

  jobScheduleLinks     JobScheduleLink[] @relation

  GoogleEventId        GoogleEventId[]
  @@map("jobs")
}

model PaymentLog {
    id              Int       @id @default(autoincrement())
    userId          Int       @map("user_id")
    user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    paymentId       String?   @map("payment_id")
    amount          Float?    @default(0)
    paymentDate     DateTime? @map("payment_date")
    status          String?  
    response        Json?    

    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")

    @@map("payment_logs")
}

model ProjectDescription {
  id                Int                @id @default(autoincrement())
  name              String
  isDeleted         Boolean?           @default(false) @map("is_deleted")

  companyId         Int?               @map("company_id")
  company           Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)


  jobs              Job[]
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("project_description")
}

model Category {
  id                      Int                    @id @default(autoincrement())
  name                    String
  isDeleted               Boolean                @default(false) @map("is_deleted")
  linkToPhase             Boolean                @default(false) @map("link_to_phase")
  phaseId                 Int?                   @map("phase_id")
  phase                   ContractorPhase?       @relation(fields: [phaseId], references: [id])
  linkToInitalSelection   Boolean                @default(false) @map("link_to_initial_selection")
  linkToPaintSelection    Boolean                @default(false) @map("link_to_paint_selection")
  linkToQuestionnaire     Boolean                @default(true) @map("link_to_questionnaire")
  isCompanyCategory       Boolean                @default(false) @map("is_company_category")
  companyId               Int?                   @map("company_id")
  company                 Company?               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  questionnaireOrder      Int                    @map("questionnaire_order")
  initialOrder            Int                    @default(0) @map("initial_order")
  paintOrder              Int                    @default(0) @map("paint_order")
  questionnaireTemplateId Int?                   @map("questionnaire_template_id")
  questionnaireTemplate   QuestionnaireTemplate? @relation(fields: [questionnaireTemplateId], references: [id], onDelete: Cascade)
  questions               TemplateQuestion[]

  contractorIds           Int[] @default([])
  phaseIds                Int[] @default([])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("categories")
}

model QuestionnaireTemplate {
  id                Int                @id @default(autoincrement())
  name              String
  isDeleted         Boolean            @default(false) @map("is_deleted")
  isCompanyTemplate Boolean            @default(true) @map("is_company_template")
  companyId         Int?               @map("company_id")
  company           Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  templateType      String             @default("Questionnaire")
  questions         TemplateQuestion[]
  categories        Category[]

  jobs           Job[]

  projectEstimatorTemplateId   Int?      @map("pet_id")
  projectEstimatorTemplate     ProjectEstimatorTemplate? @relation(fields: [projectEstimatorTemplateId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  clientTemplate          ClientTemplate[]
  @@map("questionnaire_template")
}

model TemplateQuestion {
  id                    Int     @id @default(autoincrement())
  isDeleted             Boolean @default(false) @map("is_deleted")
  linkToPhase           Boolean @default(false) @map("link_to_phase")
  linkToInitalSelection Boolean @default(false) @map("link_to_initial_selection")
  linkToPaintSelection  Boolean @default(false) @map("link_to_paint_selection")
  linkToQuestionnaire   Boolean @default(true) @map("link_to_questionnaire")
  question              String
  questionType          String
  multipleOptions       Json?
  answers               TemplateQuestionAnswer[]                
  questionnaireTemplateId Int?                   @map("questionnaire_template_id")
  questionnaireTemplate   QuestionnaireTemplate? @relation(fields: [questionnaireTemplateId], references: [id], onDelete: Cascade)
  categoryId              Int?                   @map("category_id")
  category                Category?              @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  phaseId                 Int?                   @map("phase_id")
  phase                   ContractorPhase?       @relation(fields: [phaseId], references: [id])
  questionOrder           Int   @default(0) @map("question_order") // order of question in questionnaire template
  initialQuestionOrder    Int   @default(0) @map("initial_question_order") // order of question in initial template.
  paintQuestionOrder      Int   @default(0) @map("paint_question_order")  // order of question in paint selection template.
  contractorIds           Int[] @default([])
  phaseIds                Int[] @default([])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("template_question")
}

model TemplateQuestionAnswer {
  
  id                    Int                      @id @default(autoincrement())
  questionId            Int                      @unique @map("question_id") 
  question              TemplateQuestion        @relation(fields: [questionId], references: [id], onDelete: Cascade)
  answerIds             String[]                @default([]) 
  answerText            Json?                

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("template_question_answer")
}

model Contractor {
  id                Int                @id @default(autoincrement())
  name              String
  email             String
  phaseId           Int?               @map("phase_id")
  phase             ContractorPhase?   @relation(fields: [phaseId], references: [id])
  companyId         Int?               @map("company_id")
  company           Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  isDeleted         Boolean?           @default(false) @map("is_deleted")
  JobContractor     JobContractor[]
  JobSchedule       JobSchedule[]
  contractorOrder   Int?               @map("contractor_order")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("contractors")
}

model JobContractor {
  id                Int                @id @default(autoincrement())
  companyId         Int?               @map("company_id")
  company           Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  jobId             Int?               @map("job_id")
  job               Job?               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  contractorId      Int?               @map("contractor_id")
  contractor        Contractor?        @relation(fields: [contractorId], references: [id], onDelete: Cascade)

  @@map("job_contractors")
}

model JobSchedule {
  id                Int                @id @default(autoincrement())
  companyId         Int?               @map("company_id")
  company           Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  jobId             Int?               @map("job_id")
  job               Job?               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  contractorId      Int?               @map("contractor_id")
  contractor        Contractor?        @relation(fields: [contractorId], references: [id], onDelete: Cascade)
  eventId           String?            @map("event_id")
  startDate         DateTime?          @map("start_date")
  endDate           DateTime?          @map("end_date")
  isDeleted         Boolean?           @default(false) @map("is_deleted")
  isScheduledOnWeekend Boolean?        @default(false) @map("is_scheduled_on_weekend")
  duration          Int?               @default(0) @map("duration")
  isCritical        Boolean?           @default(false) @map("is_critical")
  sourceLinks    JobScheduleLink[] @relation("SourceRelation")
  targetLinks    JobScheduleLink[] @relation("TargetRelation")
  googleEventId     GoogleEventId[]
  @@map("job_schedules")
}

model ContractorPhase {
  id                Int                @id @default(autoincrement())
  companyId         Int?               @map("company_id")
  company           Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  name              String
  isDeleted         Boolean?           @default(false) @map("is_deleted")

  contractors       Contractor[]
  categories        Category[]
  masterTemplateCategories        MasterTemplateCategory[]
  masterTemplateQuestion        MasterTemplateQuestion[]
  templateQuestion  TemplateQuestion[]
  clientCategory    ClientCategory[]
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  ClientTemplateQuestion ClientTemplateQuestion[]
  @@map("contractor_phase")
}

model JobProjectEstimatorHeader {
  id                 Int                          @id @default(autoincrement())
  name               String
  companyId          Int?                         @map("company_id")
  company            Company?                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  jobId              Int?                         @map("job_id")
  job                Job?                         @relation(fields: [jobId], references: [id], onDelete: Cascade)
  isDeleted          Boolean?                     @default(false) @map("is_deleted")

  JobProjectEstimator                             JobProjectEstimator[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  headerOrder       Int?  @default(0) @map("header_order")
  clientTemplateId Int?             @map("client_template_id")
  clientTemplate  ClientTemplate?   @relation(fields: [clientTemplateId], references: [id], onDelete: Cascade)
  
  @@map("job_project_estimator_header")
}

model JobProjectEstimator {
  id                Int                @id @default(autoincrement())
  item              String
  description       String
  costType          String?            @map("cost_type")
  quantity          Int
  unitCost          Decimal            @map("unit_cost") @db.Decimal(10, 2) @default(0.00)
  actualCost        Decimal            @map("actual_cost") @db.Decimal(10, 2) @default(0.00)
  grossProfit       Decimal            @map("gross_profit") @db.Decimal(10, 2) @default(0.00)
  contractPrice     Decimal            @map("contract_price") @db.Decimal(10, 2) @default(0.00)
  invoiceId         Int?               @map("invoice_id")
  isLootCost        Boolean?           @default(false) @map("is_loot_cost")
  isCourtesyCredit  Boolean?           @default(false) @map("is_courtesy_credit")
  isDeleted         Boolean?           @default(false) @map("is_deleted")
  order             Int?               @default(0) @map("order")
  jobProjectEstimatorHeaderId          Int? @map("job_project_estimator_header_id")
  jobProjectEstimatorHeader            JobProjectEstimatorHeader? @relation(fields: [jobProjectEstimatorHeaderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")


  @@map("job_project_estimator")
}

model ContractorFiles {
  id                Int                 @id @default(autoincrement())
  companyId         Int?                @map("company_id")
  company           Company?            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customerId        Int                 @map("customer_id")
  customer          Customer            @relation(fields: [customerId], references: [id], onDelete: Cascade)
  jobId             Int?                @map("job_id")
  job               Job?                @relation(fields: [jobId], references: [id], onDelete: Cascade)
  fileName          String
  filePath          String          

  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")

  @@map("contractor_files")
}

model TermsAndCondition {
  id                Int                 @id @default(autoincrement())
  content           String
  @@map("terms_and_condition")
}

model PaymentSchedule {
  id                 Int        @id @default(autoincrement())
  paymentDate        DateTime   @map("payment_date")
  amount             Decimal    @db.Decimal(10, 2) @default(0.00)
  addtFundDisbursed  Decimal    @db.Decimal(10, 2) @default(0.00)
  companyId          Int?       @map("company_id")
  company            Company?   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  jobId              Int?       @map("job_id")
  job                Job?       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  isDeleted          Boolean?    @default(false) @map("is_deleted")
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  draws              PaymentScheduleDraw[]

  @@map("payment_schedule")
}

model PaymentScheduleDraw {
  id                  Int             @id @default(autoincrement())
  paymentDate         DateTime        @map("payment_date")
  amount              Float           @default(0)
  drawPercentage      Float           @map("draw_percentage") @default(0)
  bankFees            Decimal?        @map("bank_fees") @db.Decimal(10, 2) @default(0.00)
  received            Boolean         @default(false)
  paymentScheduleId   Int             @map("payment_schedule_id")
  paymentSchedule     PaymentSchedule @relation(fields: [paymentScheduleId], references: [id], onDelete: Cascade)
  isDeleted           Boolean?        @default(false) @map("is_deleted")
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  @@map("payment_schedule_draw")

}

model CashFlow {
  id                Int                 @id @default(autoincrement())
  companyId         Int?                @map("company_id") @unique
  company           Company?            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  salesDeduction    Float               @default(0) @map("sales_deduction")
  deduction         Float               @default(0)
  depreciation      Float               @default(0)
  expense           Float               @default(0)

  @@map("cash_flow")
}
model ProjectEstimatorTemplate {
  id            Int      @id @default(autoincrement())
  templateName  String
  companyId     Int?      @map("company_id")
  company       Company?  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  isDeleted          Boolean?                     @default(false) @map("is_deleted")
  projectEstimatorTemplateHeader     ProjectEstimatorTemplateHeader[]

  questionnaireTemplates  QuestionnaireTemplate[]  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  profitCalculationType  ProfitCalculationType?  @default(MARGIN) @map("profilt_calculation_type")

  clientTemplate          ClientTemplate[]
  @@map("project_estimator_template")
}

model ProjectEstimatorTemplateHeader {
  id                 Int                          @id @default(autoincrement())
  petId              Int                          @map("project_estimator_template_id")
  pet                ProjectEstimatorTemplate?    @relation(fields: [petId],references: [id], onDelete: Cascade)
  name               String
  companyId          Int?                         @map("company_id")
  company            Company?                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  isDeleted          Boolean?                     @default(false) @map("is_deleted")

  ProjectEstimatorTemplateData    ProjectEstimatorTemplateData[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  headerOrder       Int?  @default(0) @map("header_order")

  @@map("project_estimator_template_header")
}


model ProjectEstimatorTemplateData {
  id                Int                @id @default(autoincrement())
  item              String
  description       String
  costType          String?            @map("cost_type")
  quantity          Int
  unitCost          Decimal            @map("unit_cost") @db.Decimal(10, 2) @default(0.00)
  actualCost        Decimal            @map("actual_cost") @db.Decimal(10, 2) @default(0.00)
  grossProfit       Decimal            @map("gross_profit") @db.Decimal(10, 2) @default(0.00)
  contractPrice     Decimal            @map("contract_price") @db.Decimal(10, 2) @default(0.00)
  isLotCost         Boolean?           @default(false) @map("is_lot_cost")
  isCourtesyCredit  Boolean?           @default(false) @map("is_courtesy_credit")
  isDeleted         Boolean?           @default(false) @map("is_deleted")

  petHeaderId       Int?               @map("project_estimator_template_header_id")
  petHeader         ProjectEstimatorTemplateHeader? @relation(fields: [petHeaderId], references: [id], onDelete: Cascade)

  order             Int?               @default(0) @map("order")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("project_estimator_template_data")
}

model ClientTemplate {
  id                      Int                      @id @default(autoincrement())
  
  questionnaireTemplateId Int?                   @map("questionnaire_template_id")
  questionnaireTemplate   QuestionnaireTemplate? @relation(fields: [questionnaireTemplateId], references: [id], onDelete: Cascade)

  projectEstimatorTemplateId   Int?      @map("pet_id")
  projectEstimatorTemplate     ProjectEstimatorTemplate? @relation(fields: [projectEstimatorTemplateId], references: [id], onDelete: Cascade)

  jobId             Int?               @map("job_id")
  job               Job?               @relation(fields: [jobId], references: [id], onDelete: Cascade)                   

  companyId         Int?               @map("company_id")
  company           Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  customerId        Int                 @map("customer_id")
  customer          Customer            @relation(fields: [customerId], references: [id], onDelete: Cascade)

  isDeleted               Boolean                  @default(false) @map("is_deleted")

  clientCategory          ClientCategory[]
  clientTemplateQuestion  ClientTemplateQuestion[]
  clientQuestionAnswer    ClientQuestionAnswer[]
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")

  accProfitCalculationType  ProfitCalculationType?  @default(MARGIN) @map("acc_profilt_calculation_type")

  jobProjectEstimatorHeader JobProjectEstimatorHeader[]
  @@map("client_template")
}

model ClientCategory {
  id                      Int                      @id @default(autoincrement())
  clientTemplateId        Int                      @map("client_template_id")
  clientTemplate          ClientTemplate           @relation(fields: [clientTemplateId], references: [id], onDelete: Cascade)
  name                    String
  isDeleted               Boolean                  @default(false) @map("is_deleted")
  linkToPhase             Boolean                  @default(false) @map("link_to_phase")
  phaseId                 Int?                     @map("phase_id")
  phase                   ContractorPhase?         @relation(fields: [phaseId], references: [id])
  linkToInitalSelection   Boolean                  @default(false) @map("link_to_initial_selection")
  linkToPaintSelection    Boolean                  @default(false) @map("link_to_paint_selection")
  linkToQuestionnaire     Boolean                  @default(true) @map("link_to_questionnaire")
  isCompanyCategory       Boolean                  @default(false) @map("is_company_category")
  companyId               Int?                     @map("company_id")
  company                 Company?                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  questionnaireOrder      Int                      @map("questionnaire_order")
  initialOrder            Int                      @default(0) @map("initial_order")
  paintOrder              Int                      @default(0) @map("paint_order")
  contractorIds           Int[]                    @default([])
  phaseIds                Int[]                    @default([])
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")

  customerId Int      @map("customer_id")
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  jobId Int? @map("job_id")
  job   Job? @relation(fields: [jobId], references: [id], onDelete: Cascade)
  ClientTemplateQuestion ClientTemplateQuestion[]
  clientQuestionAnswer  ClientQuestionAnswer[]
  @@map("client_categories")
}


model ClientTemplateQuestion {
  id                      Int                    @id @default(autoincrement())
  isDeleted               Boolean                @default(false) @map("is_deleted")
  linkToPhase             Boolean                @default(false) @map("link_to_phase")
  linkToInitalSelection   Boolean                @default(false) @map("link_to_initial_selection")
  linkToPaintSelection    Boolean                @default(false) @map("link_to_paint_selection")
  linkToQuestionnaire     Boolean                @default(true) @map("link_to_questionnaire")
  question                String
  questionType            String
  multipleOptions         Json?
  clientCategoryId        Int?                   @map("client_category_id")
  clientCategory          ClientCategory?        @relation(fields: [clientCategoryId], references: [id], onDelete: Cascade)
  phaseId                 Int?                   @map("phase_id")
  phase                   ContractorPhase?       @relation(fields: [phaseId], references: [id])
  questionOrder           Int                    @default(0) @map("question_order")
  customerId              Int                    @map("customer_id")
  customer                Customer               @relation(fields: [customerId], references: [id], onDelete: Cascade)
  jobId                  Int?                     @map("job_id")
  job                    Job?                     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  contractorIds          Int[]                    @default([])
  phaseIds               Int[]                    @default([])
  createdAt              DateTime                 @default(now()) @map("created_at")
  updatedAt              DateTime                 @updatedAt @map("updated_at")
  clientTemplateId       Int                      @map("client_template_id")
  clientTemplate         ClientTemplate           @relation(fields: [clientTemplateId], references: [id], onDelete: Cascade)
  initialQuestionOrder   Int                    @default(0) @map("initial_question_order")
  paintQuestionOrder     Int                    @default(0) @map("paint_question_order")
  answer                ClientQuestionAnswer?
  @@map("client_template_question")
}

model ClientQuestionAnswer {
  
  id                    Int                      @id @default(autoincrement())
  questionId            Int                      @unique @map("question_id") 
  question              ClientTemplateQuestion   @relation(fields: [questionId], references: [id], onDelete: Cascade)
  answerIds             String[]                @default([]) 
  answerText            Json?                
  
  jobId                  Int?                     @map("job_id")
  job                    Job?                     @relation(fields: [jobId], references: [id], onDelete: Cascade)

  customerId              Int                    @map("customer_id")
  customer                Customer               @relation(fields: [customerId], references: [id], onDelete: Cascade)

  isCompanyCategory       Boolean                  @default(false) @map("is_company_category")
  companyId               Int?                     @map("company_id")
  company                 Company?                 @relation(fields: [companyId], references: [id], onDelete: Cascade)

  clientTemplateId        Int                      @map("client_template_id")
  clientTemplate          ClientTemplate           @relation(fields: [clientTemplateId], references: [id], onDelete: Cascade)

  clientCategoryId        Int                      @map("client_category_id")
  clientCategory          ClientCategory           @relation(fields: [clientCategoryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("client_question_answer")
}

model CustomizedContent {
  id                 Int        @id @default(autoincrement())
  pageType           String?    @map("page_type")
  content            String?    
  companyId          Int?       @map("company_id")
  company            Company?   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt

  @@map("customized_contents")
  @@unique([companyId, pageType])  
}

enum TypeEnum {
  FINISH_TO_START @map("0")
  START_TO_START  @map("1")
  FINISH_TO_FINISH @map("2")
  START_TO_FINISH @map("3")
}

model JobScheduleLink {
  id  Int @id @default(autoincrement())
  
  companyId         Int           @map("company_id")
  company           Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  jobId             Int?          @map("job_id")
  job               Job?          @relation(fields: [jobId], references: [id], onDelete: Cascade)

  sourceId          Int           @map("source_id")
  source            JobSchedule   @relation("SourceRelation", fields: [sourceId], references: [id], onDelete: Cascade)

  targetId          Int           @map("target_id")
  target            JobSchedule   @relation("TargetRelation", fields: [targetId], references: [id], onDelete: Cascade)
  
  type              TypeEnum

  isDeleted         Boolean?     @default(false) @map("is_deleted")

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@map("job_schedule_link")
}

model GoogleEventId {
  id        Int @id   @default(autoincrement())
  eventId   String?   @map("event_id")

  companyId Int     @map("company_id")
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  jobId     Int?    @map("job_id")
  job       Job?    @relation(fields: [jobId], references: [id], onDelete: Cascade)

  jobScheduleId Int? @map("job_schedule_id")
  jobSchedule JobSchedule? @relation(fields: [jobScheduleId], references: [id], onDelete: Cascade)
  
  userId    Int     @map("user_id")
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  isDeleted Boolean?  @default(false) @map("is_deleted")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("google_event_id")
}

model MasterProjectEstimatorTemplate {
  id                                Int      @id @default(autoincrement())
  templateName                      String
  profitCalculationType             ProfitCalculationType?  @default(MARGIN) @map("profilt_calculation_type")
  masterQuestionnaireTemplates      MasterQuestionnaireTemplate[]  
  MasterProjectEstimatorTemplateHeader    MasterProjectEstimatorTemplateHeader[]

  isDeleted                         Boolean?                     @default(false) @map("is_deleted")
  createdAt                         DateTime @default(now()) @map("created_at")
  updatedAt                         DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("master_project_estimator_template")
}

model MasterProjectEstimatorTemplateHeader {
  id                 Int                          @id @default(autoincrement())
  mpetId             Int                          @map("master_project_estimator_template_id")
  pet                MasterProjectEstimatorTemplate?    @relation(fields: [mpetId],references: [id], onDelete: Cascade)
  name               String
  headerOrder        Int?                         @default(0) @map("header_order")

  MasterProjectEstimatorTemplateData              MasterProjectEstimatorTemplateData[]

  isDeleted          Boolean?                     @default(false) @map("is_deleted")
  createdAt          DateTime @default(now())     @map("created_at")
  updatedAt          DateTime @updatedAt          @map("updated_at")

  @@map("master_project_estimator_template_header")
}


model MasterProjectEstimatorTemplateData {
  id                Int                @id @default(autoincrement())
  item              String
  description       String
  costType          String?            @map("cost_type")
  quantity          Int
  unitCost          Decimal            @map("unit_cost") @db.Decimal(10, 2) @default(0.00)
  actualCost        Decimal            @map("actual_cost") @db.Decimal(10, 2) @default(0.00)
  grossProfit       Decimal            @map("gross_profit") @db.Decimal(10, 2) @default(0.00)
  contractPrice     Decimal            @map("contract_price") @db.Decimal(10, 2) @default(0.00)
  isLotCost         Boolean?           @default(false) @map("is_lot_cost")
  isCourtesyCredit  Boolean?           @default(false) @map("is_courtesy_credit")
  order             Int?               @default(0) @map("order")
  mpetHeaderId       Int?               @map("master_project_estimator_template_header_id")

  petHeader         MasterProjectEstimatorTemplateHeader? @relation(fields: [mpetHeaderId], references: [id], onDelete: Cascade)

  isDeleted         Boolean?           @default(false) @map("is_deleted")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("master_project_estimator_template_data")
}

model MasterQuestionnaireTemplate {
  id                Int                @id @default(autoincrement())
  name              String
  templateType      String             @default("Questionnaire")

  masterTemplateQuestions              MasterTemplateQuestion[]
  masterTemplateCategories             MasterTemplateCategory[]

  masterProjectEstimatorTemplateId   Int?      @map("m_pet_id")
  masterProjectEstimatorTemplate     MasterProjectEstimatorTemplate? @relation(fields: [masterProjectEstimatorTemplateId], references: [id], onDelete: Cascade)

  isDeleted         Boolean            @default(false) @map("is_deleted")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("master_questionnaire_template")
}


model MasterTemplateCategory {
  id                      Int                    @id @default(autoincrement())
  name                    String
  linkToPhase             Boolean                @default(false) @map("link_to_phase")
  phaseId                 Int?                   @map("phase_id")
  phase                   ContractorPhase?       @relation(fields: [phaseId], references: [id])
  linkToInitalSelection   Boolean                @default(false) @map("link_to_initial_selection")
  linkToPaintSelection    Boolean                @default(false) @map("link_to_paint_selection")
  linkToQuestionnaire     Boolean                @default(true) @map("link_to_questionnaire")
  questionnaireOrder      Int                    @map("questionnaire_order")
  initialOrder            Int                    @default(0) @map("initial_order")
  paintOrder              Int                    @default(0) @map("paint_order")
  masterQuestionnaireTemplateId Int?             @map("master_questionnaire_template_id")
  masterQuestionnaireTemplate   MasterQuestionnaireTemplate? @relation(fields: [masterQuestionnaireTemplateId], references: [id], onDelete: Cascade)
  masterQuestions               MasterTemplateQuestion[]

  phaseIds                Int[] @default([])

  isDeleted               Boolean                @default(false) @map("is_deleted")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("master_template_categories")
}

model MasterTemplateQuestion {
  id                    Int     @id @default(autoincrement())
  linkToPhase           Boolean @default(false) @map("link_to_phase")
  linkToInitalSelection Boolean @default(false) @map("link_to_initial_selection")
  linkToPaintSelection  Boolean @default(false) @map("link_to_paint_selection")
  linkToQuestionnaire   Boolean @default(true) @map("link_to_questionnaire")
  question              String
  questionType          String
  multipleOptions       Json?
  masterQuestionnaireTemplateId Int?                   @map("master_questionnaire_template_id")
  masterQuestionnaireTemplate   MasterQuestionnaireTemplate? @relation(fields: [masterQuestionnaireTemplateId], references: [id], onDelete: Cascade)
  masterTemplateCategoryId              Int?                   @map("master_t_category_id")
  masterTemplateCategory                MasterTemplateCategory?              @relation(fields: [masterTemplateCategoryId], references: [id], onDelete: Cascade)
  phaseId                 Int?                   @map("phase_id")
  phase                   ContractorPhase?       @relation(fields: [phaseId], references: [id])
  questionOrder           Int   @default(0) @map("question_order") // order of question in questionnaire template
  initialQuestionOrder    Int   @default(0) @map("initial_question_order") // order of question in initial template.
  paintQuestionOrder      Int   @default(0) @map("paint_question_order")  // order of question in paint selection template.
  phaseIds                Int[] @default([])
  
  isDeleted             Boolean @default(false) @map("is_deleted")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("master_template_question")
}